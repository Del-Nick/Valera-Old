from PIL import Image, ImageDraw
import numpy as np
from numba import njit
import uuid

prefirst_floor_coord = {'ц-21': [2078, 871, 2116, 936],
                        'ц-21а': [2116, 871, 2154, 936],
                        'ц-22': [2116, 964, 2154, 1029],
                        'ц-23': [1964, 964, 2002, 1029],
                        'ц-24': [1888, 964, 1964, 1029],
                        'ц-24б': [1888, 790, 1922, 855],
                        'ц-25': [1719, 900, 1761, 966],
                        'ц-26': [1676, 900, 1718, 966],
                        'ц-27': [1632, 901, 1675, 966],
                        'ц-28': [1589, 901, 1632, 966],
                        'ц-29': [1546, 901, 1589, 966],
                        'ц-30': [1503, 901, 1545, 966],
                        'ц-31': [1460, 901, 1502, 966],
                        'ц-32': [1416, 901, 1459, 966],
                        'ц-33': [1373, 901, 1416, 966],
                        'ц-33б': [1293, 900, 1373, 986],
                        'ц-34': [908, 900, 951, 966],
                        'ц-35': [865, 900, 908, 966],
                        'ц-36': [822, 900, 864, 966],
                        'ц-37': [779, 900, 821, 966],
                        'ц-38': [735, 900, 778, 966],
                        'ц-39': [606, 900, 692, 966],
                        'ц-39а': [692, 900, 735, 966],
                        'ц-40': [563, 900, 605, 966],
                        'ц-41': [1719, 790, 1761, 855],
                        'ц-42': [1676, 790, 1718, 855],
                        'ц-43': [1632, 790, 1675, 855],
                        'ц-44': [1589, 790, 1632, 855],
                        'ц-45': [1546, 790, 1589, 855],
                        'ц-46': [1503, 790, 1545, 855],
                        'ц-46а': [1416, 790, 1459, 855],
                        'ц-47': [865, 790, 908, 855],
                        'ц-48': [822, 790, 864, 855],
                        'ц-49': [735, 790, 778, 855],
                        'ц-49а': [692, 790, 735, 855],
                        'ц-50': [649, 790, 692, 855],
                        'ц-51': [606, 790, 648, 855],
                        'ц-52': [563, 790, 605, 855],
                        'ц-53': [364, 765, 436, 789],
                        'ц-53а': [400, 790, 436, 855],
                        'ц-54': [364, 726, 436, 764],
                        'ц-55': [364, 688, 436, 726],
                        'ц-58': [364, 495, 436, 534],
                        'ц-60а': [443, 229, 482, 394],
                        'ц-60': [404, 229, 443, 296],
                        'ц-61': [287, 229, 326, 296],
                        'ц-62': [248, 229, 287, 296],
                        'ц-63': [209, 229, 248, 296],
                        'ц-64': [170, 229, 209, 296],
                        'ц-65а': [170, 328, 209, 394],
                        'ц-65': [209, 328, 248, 394],
                        'ц-66': [248, 328, 287, 394],
                        'ц-67': [262, 534, 334, 572],
                        'ц-68': [262, 572, 334, 726],
                        'ц-69': [262, 726, 334, 764],
                        'ц-70': [246, 871, 284, 936],
                        'ц-71': [208, 871, 246, 936],
                        'ц-72': [170, 964, 208, 1029],
                        'ц-73': [208, 964, 246, 1029],
                        'ц-74': [284, 964, 322, 1029],
                        'ц-75': [322, 964, 360, 1029],
                        'ц-76': [360, 964, 398, 1029],
                        'ц-77': [398, 964, 436, 1029],
                        'ц-78': [363, 900, 436, 936],
                        'н-9': [973, 611, 990, 652],
                        'н-10': [973, 611, 990, 652],
                        'н-11': [973, 611, 990, 652],
                        'н-12': [973, 611, 990, 652],
                        'н-13': [973, 611, 990, 652],
                        'н-14': [973, 611, 990, 652],
                        'н-15': [973, 611, 990, 652],
                        'н-16': [973, 611, 990, 652],
                        'ру-цл': [2040, 871, 2078, 936],
                        'ру-цд': [779, 790, 821, 855]}
first_floor_coord = {'1-15': [2078, 868, 2116, 933],
                     '1-16': [2116, 868, 2154, 1026],
                     '1-16а': [2078, 961, 2116, 1026],
                     '1-17': [2040, 961, 2078, 1026],
                     '1-18': [2002, 961, 2040, 1026],
                     '1-19': [1964, 961, 2002, 1026],
                     '1-20': [1926, 961, 1964, 1026],
                     '1-20а': [1888, 898, 1964, 933],
                     '1-21': [1888, 961, 1926, 1026],
                     '1-22': [1719, 898, 1761, 963],
                     '1-22а': [1956, 787, 1990, 852],
                     '1-23': [1676, 898, 1718, 963],
                     '1-24': [1632, 898, 1675, 963],
                     '1-25': [1589, 898, 1632, 963],
                     '1-26': [1546, 898, 1589, 963],
                     '1-27': [1503, 898, 1545, 963],
                     '1-28': [1460, 898, 1502, 963],
                     '1-29': [1416, 898, 1459, 963],
                     '1-30': [1373, 898, 1416, 963],
                     '1-31': [1293, 898, 1373, 984],
                     '1-32': [951, 898, 1031, 984],
                     '1-33': [908, 898, 951, 963],
                     '1-34': [865, 898, 908, 963],
                     '1-35': [822, 898, 864, 963],
                     '1-36': [779, 898, 821, 963],
                     '1-37': [735, 898, 778, 963],
                     '1-38': [692, 898, 735, 963],
                     '1-39': [649, 898, 692, 963],
                     '1-40': [563, 898, 605, 963],
                     '1-41': [1719, 787, 1761, 852],
                     '1-42': [1676, 787, 1718, 852],
                     '1-43': [1632, 787, 1675, 852],
                     '1-44': [1589, 787, 1632, 852],
                     '1-45': [1546, 787, 1589, 852],
                     '1-46': [1460, 787, 1502, 852],
                     '1-47': [1416, 787, 1459, 852],
                     '1-48': [865, 787, 908, 852],
                     '1-49': [822, 787, 864, 852],
                     '1-50': [735, 787, 778, 852],
                     '1-51': [692, 787, 735, 852],
                     '1-52': [649, 787, 692, 852],
                     '1-53': [606, 787, 648, 852],
                     '1-54': [563, 787, 605, 852],
                     '1-54а': [400, 787, 436, 852],
                     '1-55': [363, 723, 436, 761],
                     '1-56': [363, 685, 436, 723],
                     '1-57': [363, 608, 436, 646],
                     '1-57а': [363, 646, 436, 684],
                     '1-58': [363, 570, 436, 607],
                     '1-59': [363, 531, 436, 569],
                     '1-60': [363, 493, 436, 531],
                     '1-61': [436, 325, 482, 391],
                     '1-61а': [363, 391, 436, 460],
                     '1-62': [443, 227, 482, 293],
                     '1-63': [365, 227, 404, 293],
                     '1-63в': [287, 227, 326, 293],
                     '1-64': [248, 227, 287, 293],
                     '1-65': [209, 227, 248, 293],
                     '1-66': [170, 227, 209, 293],
                     '1-67': [170, 325, 209, 391],
                     '1-68': [209, 325, 248, 391],
                     '1-69': [248, 325, 287, 391],
                     '1-70': [262, 493, 334, 531],
                     '1-71': [262, 531, 334, 569],
                     '1-72': [262, 570, 334, 607],
                     '1-72а': [262, 608, 334, 646],
                     '1-73': [262, 646, 334, 684],
                     '1-74': [262, 685, 334, 723],
                     '1-75': [262, 723, 334, 761],
                     '1-76': [246, 868, 284, 933],
                     '1-77': [208, 868, 246, 933],
                     '1-78': [170, 868, 208, 933],
                     '1-79': [170, 961, 208, 1026],
                     '1-80': [208, 961, 246, 1026],
                     '1-81': [284, 961, 322, 1026],
                     '1-82': [322, 961, 360, 1026],
                     '1-83': [360, 961, 398, 1026],
                     '1-84': [398, 961, 436, 1026],
                     '1-85': [363, 898, 436, 933],
                     'ру-1б': [363, 461, 436, 492],
                     'ру-1д': [779, 787, 821, 852],
                     'ру-1к': [1503, 787, 1545, 852],
                     'ру-1л': [2040, 868, 2078, 933]}
second_floor_coord = {'2-19': [1888, 852, 1960, 887],
                      '2-20': [2040, 823, 2078, 887],
                      '2-21': [2078, 823, 2116, 887],
                      '2-22': [2116, 823, 2154, 887],
                      '2-22а': [1888, 888, 1928, 915],
                      '2-23': [2116, 916, 2154, 980],
                      '2-24': [2078, 916, 2116, 980],
                      '2-25': [2040, 916, 2078, 980],
                      '2-26': [2002, 916, 2040, 980],
                      '2-27': [1964, 916, 2002, 980],
                      '2-28': [1888, 916, 1964, 980],
                      '2-29': [1888, 741, 1922, 807],
                      '2-29а': [1956, 741, 1990, 807],
                      '2-31': [1719, 852, 1761, 917],
                      '2-32': [1676, 852, 1718, 917],
                      '2-31а': [1632, 852, 1675, 917],
                      '2-32а': [1589, 852, 1632, 917],
                      '2-33а': [1546, 852, 1589, 917],
                      '2-34': [1416, 852, 1459, 917],
                      '2-35': [1373, 852, 1416, 917],
                      '2-36': [1293, 852, 1373, 938],
                      '2-38а': [1032, 852, 1083, 917],
                      '2-38': [951, 852, 1031, 938],
                      '2-39': [908, 852, 951, 917],
                      '2-40': [822, 852, 864, 917],
                      '2-40а': [865, 852, 908, 917],
                      '2-40б': [779, 852, 821, 917],
                      '2-41': [692, 852, 735, 917],
                      '2-41а': [735, 852, 778, 917],
                      '2-42': [606, 852, 648, 917],
                      '2-43': [563, 852, 605, 917],
                      '2-44': [1719, 741, 1761, 807],
                      '2-45': [1503, 741, 1545, 807],
                      '2-46': [1460, 741, 1502, 807],
                      '2-47': [1241, 741, 1292, 807],
                      '2-48': [1032, 741, 1083, 807],
                      '2-49': [822, 741, 864, 807],
                      '2-50': [779, 741, 821, 807],
                      '2-51': [606, 741, 648, 807],
                      '2-52': [563, 741, 605, 807],
                      '2-53': [364, 678, 436, 716],
                      '2-53а': [400, 741, 436, 807],
                      '2-54': [364, 640, 436, 677],
                      '2-55': [364, 601, 436, 639],
                      '2-56': [364, 563, 436, 601],
                      '2-57': [364, 524, 436, 562],
                      '2-58': [364, 414, 436, 447],
                      '2-59': [436, 279, 482, 345],
                      '2-60': [443, 181, 482, 247],
                      '2-61': [404, 181, 443, 247],
                      '2-62': [365, 181, 404, 247],
                      '2-63а': [390, 279, 436, 345],
                      '2-63': [287, 181, 326, 247],
                      '2-64': [248, 181, 287, 247],
                      '2-65': [209, 181, 248, 247],
                      '2-66': [170, 181, 209, 247],
                      '2-67': [170, 279, 209, 345],
                      '2-68': [209, 279, 248, 345],
                      '2-68а': [248, 279, 287, 345],
                      '2-69': [262, 486, 334, 524],
                      '2-70': [262, 524, 334, 562],
                      '2-71': [262, 563, 334, 601],
                      '2-72': [262, 601, 334, 639],
                      '2-73': [262, 640, 334, 677],
                      '2-74': [262, 678, 334, 716],
                      '2-75': [246, 823, 284, 887],
                      '2-76': [208, 823, 246, 887],
                      '2-77': [170, 823, 208, 887],
                      '2-78': [170, 916, 208, 980],
                      '2-79': [208, 916, 246, 980],
                      '2-80': [246, 916, 284, 980],
                      '2-81': [284, 916, 322, 980],
                      '2-82': [322, 916, 360, 980],
                      '2-83': [360, 916, 436, 980],
                      '2-84': [363, 852, 436, 887],
                      'ру-2б': [364, 384, 436, 414],
                      'цфа': [1073, 562, 1251, 741],
                      'юфа': [1537, 562, 1684, 741],
                      'сфа': [640, 562, 787, 741]}
third_floor_coord = {'3-22': [2049, 782, 2084, 842],
                     '3-23': [2084, 782, 2119, 842],
                     '3-24': [2119, 782, 2154, 842],
                     '3-25': [2084, 868, 2119, 928],
                     '3-26': [2049, 868, 2084, 928],
                     '3-27': [2014, 868, 2049, 928],
                     '3-28': [1979, 868, 2014, 928],
                     '3-29': [1944, 868, 1979, 928],
                     '3-30': [1909, 868, 1943, 928],
                     '3-31': [1909, 809, 1976, 842],
                     '3-31а': [1972, 707, 2002, 767],
                     '3-31б': [1909, 707, 1940, 767],
                     '3-32': [1712, 809, 1791, 870],
                     '3-32б': [1672, 809, 1712, 870],
                     '3-32а': [1632, 809, 1672, 870],
                     '3-33': [1592, 809, 1632, 870],
                     '3-34': [1553, 809, 1592, 870],
                     '3-35': [1513, 809, 1552, 870],
                     '3-36': [1473, 809, 1512, 870],
                     '3-37': [1433, 809, 1472, 870],
                     '3-38': [1358, 810, 1432, 889],
                     '3-39': [1310, 809, 1358, 870],
                     '3-40': [1262, 809, 1310, 870],
                     '3-41': [1214, 809, 1262, 870],
                     '3-42': [1166, 809, 1213, 870],
                     '3-43': [1117, 809, 1165, 870],
                     '3-45': [924, 810, 1043, 870],
                     '3-46': [884, 809, 923, 870],
                     '3-47а': [844, 809, 883, 870],
                     '3-47': [804, 809, 843, 870],
                     '3-48': [724, 809, 803, 870],
                     '3-49': [685, 809, 724, 870],
                     '3-50': [1752, 707, 1791, 767],
                     '3-51': [1712, 707, 1752, 767],
                     '3-51а': [1632, 707, 1672, 767],
                     '3-52': [1592, 707, 1632, 767],
                     '3-53': [1473, 707, 1512, 767],
                     '3-54': [1513, 707, 1552, 767],
                     '3-55': [1117, 707, 1358, 767],
                     '3-56а': [963, 707, 1003, 767],
                     '3-56': [923, 707, 963, 767],
                     '3-57': [844, 707, 883, 767],
                     '3-58': [804, 707, 843, 767],
                     '3-59а': [764, 707, 803, 767],
                     '3-59': [684, 707, 724, 767],
                     '3-60': [534, 707, 567, 767],
                     '3-61': [500, 648, 567, 684],
                     '3-62': [500, 613, 567, 648],
                     '3-63': [500, 577, 567, 612],
                     '3-64': [500, 506, 567, 541],
                     '3-65': [500, 471, 567, 506],
                     '3-66': [500, 435, 567, 470],
                     '3-67': [500, 405, 567, 435],
                     '3-68': [567, 280, 609, 341],
                     '3-69': [574, 189, 610, 251],
                     '3-70': [538, 189, 574, 251],
                     '3-71': [502, 189, 538, 251],
                     '3-72': [430, 189, 465, 251],
                     '3-73': [322, 189, 429, 341],
                     '3-74': [406, 435, 473, 470],
                     '3-75': [406, 471, 473, 506],
                     '3-76': [406, 506, 473, 541],
                     '3-77': [406, 542, 473, 577],
                     '3-78': [406, 613, 473, 648],
                     '3-79': [406, 648, 473, 684],
                     '3-80': [392, 782, 426, 842],
                     '3-80а': [357, 782, 391, 842],
                     '3-80б': [322, 782, 356, 842],
                     '3-81': [322, 868, 356, 928],
                     '3-82': [357, 868, 391, 928],
                     '3-83': [392, 868, 426, 928],
                     '3-83а': [427, 868, 461, 928],
                     '3-84': [462, 868, 497, 928],
                     '3-85': [497, 868, 567, 928],
                     '3-86': [500, 809, 567, 842],
                     'ру-3б': [500, 376, 567, 405],
                     'ру-3д': [884, 707, 923, 767]}
fourth_floor_coord = {'4-17': [2183, 841, 2221, 906],
                      '4-18': [2222, 934, 2260, 999],
                      '4-19': [2145, 934, 2183, 999],
                      '4-19а': [2106, 934, 2144, 999],
                      '4-20': [2068, 934, 2106, 999],
                      '4-21': [1991, 906, 2068, 999],
                      '4-22а': [2060, 760, 2094, 825],
                      '4-22б': [1991, 760, 2025, 825],
                      '4-23а': [1820, 871, 1863, 936],
                      '4-23': [1733, 871, 1820, 936],
                      '4-24': [1689, 871, 1732, 936],
                      '4-25': [1645, 871, 1688, 936],
                      '4-26': [1602, 871, 1645, 936],
                      '4-26а': [1514, 871, 1557, 936],
                      '4-27': [1471, 871, 1514, 936],
                      '4-28': [1390, 871, 1470, 957],
                      '4-29': [1337, 871, 1389, 936],
                      '4-30': [1284, 871, 1336, 936],
                      '4-31': [1231, 871, 1284, 936],
                      '4-32': [1179, 871, 1231, 936],
                      '4-33': [1126, 871, 1178, 936],
                      '4-34': [1045, 871, 1125, 957],
                      '4-35': [1001, 871, 1044, 936],
                      '4-36': [914, 871, 1001, 936],
                      '4-37': [870, 871, 913, 936],
                      '4-38': [827, 871, 870, 936],
                      '4-39а': [739, 871, 826, 936],
                      '4-39': [652, 871, 739, 936],
                      '4-40': [1820, 760, 1863, 825],
                      '4-41': [1733, 760, 1820, 825],
                      '4-42': [1645, 760, 1732, 825],
                      '4-43': [1558, 760, 1601, 825],
                      '4-44': [1514, 760, 1557, 825],
                      '4-45': [957, 760, 1001, 825],
                      '4-46': [914, 760, 957, 825],
                      '4-47': [870, 760, 913, 825],
                      '4-48': [827, 760, 870, 825],
                      '4-49': [783, 760, 826, 825],
                      '4-50': [739, 760, 782, 825],
                      '4-51': [652, 760, 739, 825],
                      '4-52': [488, 760, 524, 825],
                      '4-53': [451, 697, 524, 735],
                      '4-54': [451, 658, 524, 696],
                      '4-55': [451, 620, 524, 658],
                      '4-56': [451, 581, 524, 620],
                      '4-57': [451, 543, 524, 581],
                      '4-58': [451, 505, 524, 543],
                      '4-59': [451, 434, 524, 466],
                      '4-60': [478, 298, 571, 364],
                      '4-61': [531, 200, 571, 267],
                      '4-62': [492, 200, 531, 267],
                      '4-63': [452, 200, 491, 267],
                      '4-64': [413, 200, 452, 267],
                      '4-65': [374, 200, 413, 267],
                      '4-65а': [255, 200, 373, 364],
                      '4-66': [348, 466, 421, 504],
                      '4-67': [348, 505, 421, 543],
                      '4-68': [348, 543, 421, 581],
                      '4-69': [348, 581, 421, 620],
                      '4-70': [348, 620, 421, 658],
                      '4-71': [348, 697, 421, 735],
                      '4-72': [332, 841, 370, 906],
                      '4-73': [294, 841, 332, 906],
                      '4-74': [255, 934, 293, 999],
                      '4-75': [294, 934, 408, 999],
                      '4-76': [409, 934, 447, 999],
                      '4-77': [447, 934, 485, 999],
                      '4-78': [486, 934, 524, 999],
                      '4-78а': [451, 871, 524, 906],
                      'ру-4б': [451, 402, 524, 434]}
fifth_floor_coord = {'5-18': [2142, 860, 2260, 926],
                     '5-19': [2102, 927, 2260, 1022],
                     '5-20': [2062, 955, 2102, 1022],
                     '5-21': [2023, 955, 2062, 1022],
                     '5-22': [1983, 955, 2022, 1022],
                     '5-22а': [1983, 891, 2059, 927],
                     '5-23': [1762, 891, 1852, 957],
                     '5-24': [1717, 891, 1762, 957],
                     '5-25': [1628, 891, 1672, 957],
                     '5-26': [1538, 891, 1627, 957],
                     '5-27': [1448, 891, 1537, 957],
                     '5-33': [965, 891, 1009, 957],
                     '5-33а': [920, 891, 964, 957],
                     '5-34': [875, 891, 920, 957],
                     '5-33в': [830, 891, 875, 957],
                     '5-35': [740, 891, 830, 957],
                     '5-36': [651, 891, 740, 957],
                     '5-37': [606, 891, 650, 957],
                     '5-38а': [1983, 777, 2018, 844],
                     '5-38': [1807, 777, 1852, 844],
                     '5-39': [1717, 777, 1807, 844],
                     '5-40': [1628, 777, 1717, 844],
                     '5-41': [1583, 777, 1627, 844],
                     '5-42': [1493, 777, 1582, 844],
                     '5-43': [920, 777, 964, 844],
                     '5-44': [875, 777, 920, 844],
                     '5-45': [830, 777, 875, 844],
                     '5-46': [740, 777, 830, 844],
                     '5-47': [651, 777, 740, 844],
                     '5-48': [606, 777, 650, 844],
                     '5-48а': [437, 777, 474, 844],
                     '5-49': [399, 712, 474, 751],
                     '5-50': [399, 634, 474, 672],
                     '5-51': [399, 515, 474, 594],
                     '5-52': [399, 476, 474, 515],
                     '5-52а': [399, 411, 474, 476],
                     '5-53': [426, 304, 522, 372],
                     '5-54': [482, 204, 522, 272],
                     '5-55': [441, 204, 481, 272],
                     '5-56': [401, 204, 441, 272],
                     '5-57': [360, 204, 400, 272],
                     '5-58': [319, 204, 359, 272],
                     '5-59': [198, 204, 319, 372],
                     '5-60': [293, 476, 368, 554],
                     '5-61': [293, 555, 368, 672],
                     '5-62': [293, 712, 368, 751],
                     '5-63': [277, 860, 316, 927],
                     '5-64': [198, 860, 276, 927],
                     '5-65': [198, 955, 237, 1022],
                     '5-66': [237, 955, 316, 1022],
                     '5-67': [316, 955, 355, 1022],
                     '5-68б': [356, 955, 395, 1022],
                     '5-68': [395, 955, 474, 1022],
                     '5-68а': [435, 927, 474, 955],
                     '5-69': [399, 891, 474, 926],
                     'библиотека': [1093, 777, 1364, 957],
                     'ниияф': [1935, 204, 2260, 372],
                     'лкаб': [830, 891, 1009, 957]}

prefirst_floor = {'ц-21': [9020, 3871],
                  'ц-21а': [9236, 3871],
                  'ц-22': [9236, 4302],
                  'ц-23': [8514, 4302],
                  'ц-24': [8298, 4302],
                  'ц-24б': [8226, 3585],
                  'ц-25': [7504, 4015],
                  'ц-26': [7360, 4015],
                  'ц-27': [7143, 4015],
                  'ц-28': [6927, 4015],
                  'ц-29': [6783, 4015],
                  'ц-30': [6566, 4015],
                  'ц-31': [6422, 4015],
                  'ц-32': [6205, 4015],
                  'ц-33': [5989, 4015],
                  'ц-33б': [5772, 4015],
                  'ц-34': [3968, 4015],
                  'ц-35': [3824, 4015],
                  'ц-36': [3608, 4015],
                  'ц-37': [3463, 4015],
                  'ц-38': [3247, 4015],
                  'ц-39': [2742, 4015],
                  'ц-39а': [3102, 4015],
                  'ц-40': [2450, 3900],
                  'ц-41': [7504, 3585],
                  'ц-42': [7288, 3585],
                  'ц-43': [7143, 3585],
                  'ц-44': [6850, 3410],
                  'ц-45': [6710, 3585],
                  'ц-46': [6500, 3410],
                  'ц-46а': [6205, 3585],
                  'ц-47': [3824, 3585],
                  'ц-48': [3608, 3585],
                  'ц-49': [3247, 3585],
                  'ц-49а': [3102, 3585],
                  'ц-50': [2886, 3585],
                  'ц-51': [2669, 3585],
                  'ц-52': [2525, 3585],
                  'ц-53': [1804, 3334],
                  'ц-53а': [1804, 3585],
                  'ц-54': [1804, 3154],
                  'ц-55': [1600, 3000],
                  'ц-58': [1804, 2222],
                  'ц-60а': [2020, 1362],
                  'ц-60': [1804, 1147],
                  'ц-61': [1298, 1147],
                  'ц-62': [1154, 1147],
                  'ц-63': [938, 1147],
                  'ц-64': [793, 1147],
                  'ц-65а': [793, 1577],
                  'ц-65': [938, 1577],
                  'ц-66': [1154, 1577],
                  'ц-67': [1298, 2366],
                  'ц-68': [1298, 2500],
                  'ц-69': [1150, 3150],
                  'ц-70': [1154, 3871],
                  'ц-71': [938, 3871],
                  'ц-72': [793, 4302],
                  'ц-73': [938, 4302],
                  'ц-74': [1298, 4302],
                  'ц-75': [1443, 4302],
                  'ц-76': [1659, 4302],
                  'ц-77': [1804, 4302],
                  'ц-78': [1731, 3943],
                  'н-9': [4200, 2700],
                  'н-10': [4200, 2700],
                  'н-11': [4200, 2700],
                  'н-12': [4200, 2700],
                  'н-13': [4200, 2700],
                  'н-14': [4200, 2700],
                  'н-15': [4200, 2700],
                  'н-16': [4200, 2700],
                  'ру-цл': [8875, 3871],
                  'ру-цд': [3463, 3513]}
first_floor = {'1-15': [8982, 3854],
               '1-16': [9186, 4286],
               '1-16а': [9078, 4226],
               '1-17': [8910, 4258],
               '1-18': [8670, 4166],
               '1-19': [8538, 4170],
               '1-20': [8422, 4226],
               '1-20а': [8150, 3900],
               '1-21': [8242, 4154],
               '1-22': [7540, 3910],
               '1-22а': [8530, 3606],
               '1-23': [7360, 3910],
               '1-24': [7160, 3910],
               '1-25': [7000, 3910],
               '1-26': [6800, 3910],
               '1-27': [6600, 3910],
               '1-28': [6400, 3910],
               '1-29': [6200, 3910],
               '1-30': [6000, 3910],
               '1-31': [5800, 3910],
               '1-32': [4136, 3910],
               '1-33': [4000, 3910],
               '1-34': [3750, 3900],
               '1-35': [3692, 3910],
               '1-36': [3504, 3910],
               '1-37': [3308, 3910],
               '1-38': [3124, 3910],
               '1-39': [2944, 3910],
               '1-40': [2571, 3910],
               '1-41': [7544, 3450],
               '1-42': [7354, 3450],
               '1-43': [7184, 3450],
               '1-44': [6984, 3450],
               '1-45': [6792, 3450],
               '1-46': [6428, 3450],
               '1-47': [6232, 3450],
               '1-48': [3880, 3450],
               '1-49': [3711, 3450],
               '1-50': [3323, 3450],
               '1-51': [3131, 3450],
               '1-52': [2939, 3450],
               '1-53': [2763, 3450],
               '1-54': [2575, 3450],
               '1-54а': [1741, 3422],
               '1-55': [1850, 3158],
               '1-56': [1850, 2974],
               '1-57': [1600, 2650],
               '1-57а': [1850, 2822],
               '1-58': [1850, 2490],
               '1-59': [1850, 2318],
               '1-60': [1600, 2150],
               '1-61': [1900, 1420],
               '1-61а': [1850, 1750],
               '1-62': [2053, 1000],
               '1-63': [1600, 1000],
               '1-63в': [1381, 1000],
               '1-64': [1213, 1000],
               '1-65': [1033, 1000],
               '1-66': [870, 1000],
               '1-67': [740, 1420],
               '1-68': [920, 1420],
               '1-69': [1100, 1420],
               '1-70': [1150, 2158],
               '1-71': [1150, 2334],
               '1-72': [1150, 2498],
               '1-72а': [1150, 2654],
               '1-73': [1150, 2826],
               '1-74': [1150, 2994],
               '1-75': [1150, 3146],
               '1-76': [1193, 3800],
               '1-77': [1037, 3800],
               '1-78': [873, 3800],
               '1-79': [877, 4200],
               '1-80': [1029, 4200],
               '1-81': [1357, 4200],
               '1-82': [1525, 4200],
               '1-83': [1677, 4200],
               '1-84': [1849, 4200],
               '1-85': [1580, 3880],
               'ру-1б': [1850, 2006],
               'ру-1д': [3503, 3450],
               'ру-1к': [6620, 3450],
               'ру-1л': [8806, 3802]
               }
second_floor = {'2-19': [8330, 3740],
                '2-20': [8910, 3668],
                '2-21': [9055, 3668],
                '2-22': [9199, 3668],
                '2-22а': [8258, 3884],
                '2-23': [9199, 4100],
                '2-24': [9055, 4100],
                '2-25': [8910, 4100],
                '2-26': [8765, 4100],
                '2-27': [8460, 4100],
                '2-28': [8150, 4100],
                '2-29': [8258, 3380],
                '2-29а': [8547, 3380],
                '2-31': [7533, 3812],
                '2-32': [7388, 3812],
                '2-31а': [7171, 3812],
                '2-32а': [6954, 3812],
                '2-33а': [6809, 3812],
                '2-34': [6229, 3812],
                '2-35': [6084, 3812],
                '2-36': [5795, 3700],
                '2-38а': [4563, 3812],
                '2-38': [4346, 3700],
                '2-39': [4056, 3812],
                '2-40': [3622, 3812],
                '2-40а': [3839, 3812],
                '2-40б': [3477, 3812],
                '2-41': [3114, 3812],
                '2-41а': [3332, 3812],
                '2-42': [2630, 3812],
                '2-43': [2430, 3812],
                '2-44': [7533, 3380],
                '2-45': [6475, 3200],
                '2-46': [6290, 3200],
                '2-47': [5350, 3200],
                '2-48': [4563, 3380],
                '2-49': [3622, 3380],
                '2-50': [3477, 3380],
                '2-51': [2680, 3380],
                '2-52': [2535, 3380],
                '2-53': [1738, 3021],
                '2-53а': [1811, 3380],
                '2-54': [1738, 2877],
                '2-55': [1738, 2661],
                '2-56': [1738, 2517],
                '2-57': [1738, 2373],
                '2-58': [1738, 1870],
                '2-59': [1955, 1366],
                '2-60': [2028, 935],
                '2-61': [1811, 935],
                '2-62': [1666, 935],
                '2-63а': [1738, 1366],
                '2-63': [1303, 935],
                '2-64': [1159, 935],
                '2-65': [941, 935],
                '2-66': [796, 935],
                '2-67': [796, 1366],
                '2-68': [941, 1366],
                '2-68а': [1159, 1366],
                '2-69': [1303, 2157],
                '2-70': [1303, 2373],
                '2-71': [1303, 2517],
                '2-72': [1303, 2661],
                '2-73': [1303, 2877],
                '2-74': [1303, 3021],
                '2-75': [1159, 3668],
                '2-76': [941, 3668],
                '2-77': [796, 3668],
                '2-78': [796, 4100],
                '2-79': [941, 4100],
                '2-80': [1159, 4100],
                '2-81': [1303, 4100],
                '2-82': [1448, 4100],
                '2-83': [1666, 4100],
                '2-84': [1738, 3740],
                'ру-2б': [1738, 1726],
                'цфа': [4998, 2500],
                'юфа': [7026, 2500],
                'сфа': [3042, 2500],
                'ниияф': [8620, 1150]}
third_floor = {'3-22': [8841, 3493],
               '3-23': [9056, 3493],
               '3-24': [9200, 3493],
               '3-25': [9056, 3850],
               '3-26': [8841, 3850],
               '3-27': [8697, 3850],
               '3-28': [8553, 3850],
               '3-29': [8409, 3850],
               '3-30': [8266, 3850],
               '3-31': [8338, 3493],
               '3-31а': [8553, 3137],
               '3-31б': [8266, 3137],
               '3-32': [7475, 3565],
               '3-32б': [7259, 3565],
               '3-32а': [7116, 3565],
               '3-33': [6900, 3565],
               '3-34': [6756, 3565],
               '3-35': [6612, 3565],
               '3-36': [6469, 3565],
               '3-37': [6253, 3565],
               '3-38': [5966, 3565],
               '3-39': [5750, 3565],
               '3-40': [5534, 3565],
               '3-41': [5319, 3565],
               '3-42': [5103, 3565],
               '3-43': [4887, 3565],
               '3-45': [4240, 3565],
               '3-46': [3881, 3565],
               '3-47а': [3665, 3565],
               '3-47': [3522, 3565],
               '3-48': [3306, 3565],
               '3-49': [2950, 3500],
               '3-50': [7619, 3137],
               '3-51': [7403, 3137],
               '3-51а': [7116, 3137],
               '3-52': [6900, 3137],
               '3-53': [6397, 3137],
               '3-54': [6612, 3137],
               '3-55': [5319, 3137],
               '3-56а': [4240, 3137],
               '3-56': [4025, 3137],
               '3-57': [3665, 3137],
               '3-58': [3522, 3137],
               '3-59а': [3378, 3137],
               '3-59': [3018, 3137],
               '3-60': [2372, 3137],
               '3-61': [2372, 2852],
               '3-62': [2372, 2709],
               '3-63': [2372, 2566],
               '3-64': [2160, 2200],
               '3-65': [2372, 2139],
               '3-66': [2160, 1900],
               '3-67': [2372, 1782],
               '3-68': [2515, 1283],
               '3-69': [2515, 998],
               '3-70': [2372, 998],
               '3-71': [2228, 998],
               '3-72': [1940, 998],
               '3-73': [1653, 1140],
               '3-74': [1868, 1925],
               '3-75': [1868, 2139],
               '3-76': [1868, 2281],
               '3-77': [1868, 2424],
               '3-78': [1868, 2709],
               '3-79': [1868, 2852],
               '3-80': [1725, 3493],
               '3-80а': [1581, 3493],
               '3-80б': [1437, 3493],
               '3-81': [1437, 3850],
               '3-82': [1581, 3850],
               '3-83': [1725, 3850],
               '3-83а': [1868, 3850],
               '3-84': [2084, 3850],
               '3-85': [2300, 3850],
               '3-86': [2300, 3621],
               'ниияф': [8625, 1140],
               'ру-3б': [2300, 1675],
               'ру-3д': [3881, 3137]}
fourth_floor = {'4-17': [9432, 3720],
                '4-18': [9648, 4149],
                '4-19': [9288, 4149],
                '4-19а': [9144, 4149],
                '4-20': [9000, 4149],
                '4-21': [8712, 4149],
                '4-22а': [8928, 3434],
                '4-22б': [8640, 3434],
                '4-23а': [7920, 3863],
                '4-23': [7632, 3863],
                '4-24': [7344, 3863],
                '4-25': [7200, 3863],
                '4-26': [6984, 3863],
                '4-26а': [6552, 3863],
                '4-27': [6408, 3863],
                '4-28': [6120, 3863],
                '4-29': [5832, 3863],
                '4-30': [5616, 3863],
                '4-31': [5400, 3863],
                '4-32': [5184, 3863],
                '4-33': [4968, 3863],
                '4-34': [4608, 3863],
                '4-35': [4392, 3863],
                '4-36': [4104, 3863],
                '4-37': [3816, 3863],
                '4-38': [3672, 3863],
                '4-39а': [3384, 3863],
                '4-39': [2952, 3863],
                '4-40': [7840, 3280],
                '4-41': [7632, 3434],
                '4-42': [7272, 3434],
                '4-43': [6768, 3434],
                '4-44': [6530, 3280],
                '4-45': [4176, 3434],
                '4-46': [4032, 3434],
                '4-47': [3816, 3434],
                '4-48': [3672, 3434],
                '4-49': [3456, 3434],
                '4-50': [3240, 3434],
                '4-51': [2952, 3434],
                '4-52': [2160, 3434],
                '4-53': [2160, 3076],
                '4-54': [2160, 2933],
                '4-55': [2160, 2790],
                '4-56': [2160, 2575],
                '4-57': [2160, 2432],
                '4-58': [2160, 2289],
                '4-59': [2160, 1931],
                '4-60': [2376, 1431],
                '4-61': [2376, 1001],
                '4-62': [2160, 1001],
                '4-63': [2016, 1001],
                '4-64': [1872, 1001],
                '4-65': [1656, 1001],
                '4-65а': [1296, 1287],
                '4-66': [1656, 2074],
                '4-67': [1656, 2218],
                '4-68': [1656, 2361],
                '4-69': [1656, 2575],
                '4-70': [1656, 2718],
                '4-71': [1656, 3076],
                '4-72': [1512, 3720],
                '4-73': [1368, 3720],
                '4-74': [1152, 4149],
                '4-75': [1512, 4149],
                '4-76': [1800, 4149],
                '4-77': [2016, 4149],
                '4-78': [2160, 4149],
                '4-78а': [2088, 3792],
                'ру-4б': [2088, 1788],
                'ниияф': [9072, 1216]}
fifth_floor = {'5-18': [9455, 3870],
               '5-19': [9455, 4300],
               '5-20': [8950, 4300],
               '5-21': [8805, 4300],
               '5-22': [8550, 4120],
               '5-22а': [8733, 3942],
               '5-23': [7795, 4014],
               '5-24': [7506, 4014],
               '5-25': [7145, 4014],
               '5-26': [6857, 4014],
               '5-27': [6496, 4014],
               '5-33': [4258, 4014],
               '5-33а': [4042, 4014],
               '5-34': [3897, 4014],
               '5-33в': [3681, 4014],
               '5-35': [3392, 4014],
               '5-36': [2959, 4014],
               '5-37': [2742, 4014],
               '5-38а': [8661, 3512],
               '5-38': [7867, 3512],
               '5-39': [7578, 3512],
               '5-40': [7218, 3512],
               '5-41': [6929, 3512],
               '5-42': [6640, 3512],
               '5-43': [4042, 3512],
               '5-44': [3825, 3512],
               '5-45': [3681, 3512],
               '5-46': [3392, 3512],
               '5-47': [2959, 3512],
               '5-48': [2670, 3512],
               '5-48а': [1948, 3512],
               '5-49': [1876, 3153],
               '5-50': [1876, 2795],
               '5-51': [1876, 2365],
               '5-52': [1876, 2150],
               '5-52а': [1876, 1935],
               '5-53': [2165, 1433],
               '5-54': [2165, 1003],
               '5-55': [1948, 1003],
               '5-56': [1804, 1003],
               '5-57': [1660, 1003],
               '5-58': [1443, 1003],
               '5-59': [1227, 1218],
               '5-60': [1443, 2150],
               '5-61': [1443, 2652],
               '5-62': [1443, 3153],
               '5-63': [1299, 3870],
               '5-64': [1010, 3870],
               '5-65': [938, 4300],
               '5-66': [1154, 4300],
               '5-67': [1443, 4300],
               '5-68б': [1587, 4300],
               '5-68': [1876, 4300],
               '5-68а': [1948, 4049],
               '5-69': [1876, 3870],
               'библиотека': [4750, 3350],
               'ниияф': [9022, 1100]}

floors = [prefirst_floor, first_floor, second_floor, third_floor, fourth_floor, fifth_floor]
floors_coord = [prefirst_floor_coord, first_floor_coord, second_floor_coord, third_floor_coord, fourth_floor_coord,
                fifth_floor_coord]


@njit
def search_rectangle(x_0, y_0, array):
    x = x_0
    while True:
        if (np.sum(array[x - 1:x + 1, y_0 - 50:y_0]) != 0) & (np.sum(array[x - 1:x + 1, y_0:y_0 + 50]) != 0):
            x -= 1
            # print(f'x_1     {x}:    {array[x][y_0]}     {np.sum(array[x][y_0-50:y_0])}      {np.sum(array[x][y_0:y_0+50])}')
        else:
            break

    x -= 1
    x_1 = x

    y = y_0

    while array[x + 10][y] != 0:
        y -= 1
        # print(f'y_1     {y}:    {array[x+2][y]}')

    y_1 = y - 1
    x += 60

    while array[x][y + 10] != 0:
        x += 1
        # print(f'x_2     {x}:    {array[x][y+10]}')

    x_2 = x + 1
    y += 50

    while array[x - 10][y] != 0:
        y += 1
        # print(f'y_2     {y}:    {array[x-2][y]}')

    y_2 = y + 1

    return x_1, y_1, x_2, y_2


@njit
def search_polygon(x_0, y_0, array):
    x = x_0
    while True:
        if (np.sum(array[x - 1:x + 1, y_0 - 50:y_0]) != 0) & (np.sum(array[x - 1:x + 1, y_0:y_0 + 50]) != 0):
            x -= 1
            print(
                f'x_1     {x}:    {array[x][y_0]}     {np.sum(array[x][y_0 - 50:y_0])}      {np.sum(array[x][y_0:y_0 + 50])}')
        else:
            break

    x -= 1
    x_1 = x

    y = y_0

    while array[x + 10][y] != 0:
        y -= 1
        print(f'y_1     {y}:    {array[x + 2][y]}')

    y_1 = y - 1
    x += 130

    while array[x][y + 10] != 0:
        x += 1
        print(f'x_2     {x}:    {array[x][y + 2]}')

    x_2 = x + 1
    y += 50

    while array[x - 10][y] != 0:
        y += 1
        print(f'y_2     {y}:    {array[x - 2][y]}')

    y_2 = y + 1

    return x_1, y_1, x_2, y_2


@njit
def fill(array, x_1, y_1, x_2, y_2, room):
    for x in range(x_1, x_2):
        for y in range(y_1, y_2):
            if array[y][x][0] > 50:
                array[y][x][0] = array[y][x][0] / 255 * 255
                array[y][x][1] = array[y][x][1] / 255 * 145
                array[y][x][2] = 0

    return array


def steps(steps_img, img, x_1, y_1, x_2, y_2, floor):
    print(x_1, y_1, x_2, y_2)

    if floor == 5:
        x_0 = 4488
        y_0 = 3564
        width, height = steps_img.size

    if (x_1 > 1879) and (y_1 > 3300) and (x_2 < 4350) and (y_2 < 4150):

        temp = steps_img.rotate(270, expand=True)
        img.paste(temp, (x_0, y_0), temp)

        koef = 96.5

        y_0 += 71
        # x_0 += koef

        for k in range(3):
            alpha_0 = 270 - 45 * k
            temp = steps_img.rotate(alpha_0, expand=True)
            img.paste(temp, (int(x_0 - 1.5 * koef * k / 3), int(y_0 + koef * k / 3)), temp)

        x_0 -= 163
        y_0 += 63

        temp = steps_img.rotate(180, expand=True)
        # adding = int(((x_0 - (x_1 + x_2) / 2 - width*1.2) % width) / (int((x_0 - (x_1 + x_2) / 2 - width*1.2) / width)))
        adding = (x_0 - (x_1 + x_2) / 2 - width * 1.2) / width
        for k in range(int((x_0 - (x_1 + x_2) / 2 - width * 1.2) / width)):
            img.paste(temp, (x_0 - k * width - int(k * adding), y_0), temp)
        print((x_0 - (x_1 + x_2) / 2) % width, (int(round((x_0 - (x_1 + x_2) / 2) / width))), adding)

        x_0 -= k * (width + adding) + 20

        if y_1 > y_0:
            temp = steps_img.rotate(180, expand=True)
            img.paste(temp, (x_0, y_0), temp)

            temp = steps_img.rotate(225, expand=True)
            img.paste(temp, (x_0 - width, y_0), temp)

            temp = steps_img.rotate(270, expand=True)
            img.paste(temp, (x_0 - int(width * 1.2), y_0 + width), temp)

        else:
            temp = steps_img.rotate(180, expand=True)
            img.paste(temp, (x_0, y_0), temp)

            temp = steps_img.rotate(135, expand=True)
            img.paste(temp, (x_0 - width, y_0 - int(width / 2)), temp)

            temp = steps_img.rotate(90, expand=True)
            img.paste(temp, (x_0 - int(width), y_0 - width), temp)

    elif (x_1 > 800) and (y_1 > 3600) and (x_2 < 2050) and (y_2 < 4400):

        temp = steps_img.rotate(270, expand=True)
        img.paste(temp, (x_0, y_0), temp)

        koef = 96.5

        y_0 += 71
        # x_0 += koef

        for k in range(3):
            alpha_0 = 270 - 45 * k
            temp = steps_img.rotate(alpha_0, expand=True)
            img.paste(temp, (int(x_0 - 1.5 * koef * k / 3), int(y_0 + koef * k / 3)), temp)

        x_0 -= 163
        y_0 += 63

        temp = steps_img.rotate(180, expand=True)
        adding = int((x_0 - 1650 + koef) % width / (int((x_0 - 1800 + koef) / width)))
        for k in range(int((x_0 - 1800 + koef) / width)):
            img.paste(temp, ((x_0 - k * width - k * adding), y_0), temp)
        print((x_0 - 1650 + koef) % width, int((x_0 - 1800 + koef) / width),
              int(((x_0 - 1650 + koef) % width * width) / (int((x_0 - 1800 + koef) / width))))

        x_0 = 1700

        temp = steps_img.rotate(180, expand=True)
        img.paste(temp, (x_0, y_0), temp)

        temp = steps_img.rotate(225, expand=True)
        img.paste(temp, (x_0 - width, y_0), temp)

        temp = steps_img.rotate(270, expand=True)
        img.paste(temp, (x_0 - int(width * 1.2), y_0 + width), temp)

        x_0 -= int(width * 1.2)
        y_0 += width * 2

        temp = steps_img.rotate(270, expand=True)
        img.paste(temp, (x_0, y_0), temp)

        y_0 += k * width + 35

        if x_1 < 1500:
            temp = steps_img.rotate(270, expand=True)
            img.paste(temp, (x_0, y_0), temp)

            temp = steps_img.rotate(225, expand=True)
            img.paste(temp, (x_0 - int(width / 2), y_0 + int(width / 2)), temp)

            temp = steps_img.rotate(180, expand=True)
            img.paste(temp, (x_0 - width, y_0 + int(width)), temp)

    return img


@njit
def binary(array):
    width, height = np.shape(array)
    for x in range(width):
        for y in range(height):
            if array[x][y] < 100:
                array[x][y] = 0
            else:
                array[x][y] = 255
    return array


def rooms(room, floor):
    print(room)
    alpha = Image.open(f'Rooms/{floor} floor alpha.png').convert('RGBA')
    width, height = alpha.size

    img = Image.new('RGB', (width, height), (255, 255, 255))
    width, height = img.size

    if room in floors_coord[floor].keys():
        x_1, y_1, x_2, y_2 = floors_coord[floor][room]
        ImageDraw.Draw(img).rectangle((x_1, y_1, x_2, y_2), fill=(255, 145, 0))

        if room == 'ниияф':
            ImageDraw.Draw(img).rectangle((1985, 372, 2089, 777), fill=(255, 145, 0))
            ImageDraw.Draw(img).rectangle((2083, 477, 2165, 751), fill=(255, 145, 0))
        elif room == '3-86':
            ImageDraw.Draw(img).rectangle((535, 842, 567, 868), fill=(255, 145, 0))

        img.paste(alpha, (0, 0), alpha)

        hash_name = uuid.uuid4()
        path = f"Rooms/Temp/{hash_name}.png"
        img.save(path, quality=100, subsamplint=False)

        return path

# for room in fifth_floor_coord.keys():
#     print(f"'{room}': [{int(fifth_floor_coord[room][0] / 4)}, "
#           f"{int(fifth_floor_coord[room][1] / 4)}, "
#           f"{int(fifth_floor_coord[room][2] / 4)}, "
#           f"{int(fifth_floor_coord[room][3] / 4)}],")
